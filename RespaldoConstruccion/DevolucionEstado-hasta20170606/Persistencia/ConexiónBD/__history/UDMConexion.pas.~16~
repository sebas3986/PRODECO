unit UDMConexion;

interface

uses
  Forms, SysUtils, Classes, ZAbstractConnection, ZConnection,ActiveX,FPGenerales;

type
  TDMConexion = class(TDataModule)
    ZConexion: TZConnection;
    procedure DataModuleCreate(Sender: TObject);
  private
    FHost     : string;
    FUsuario  : string;
    FPassword : string;
    FBaseDatos: string;
    FEsquema  : string;
    FPuerto   : Integer;
    FAmbiente : string;
    FTipoConeFtp : string;


  public
    Property Esquema: string read FEsquema write FEsquema;
    property Ambiente: string read FAmbiente write FAmbiente;

    procedure Conectar;

  end;

var
  DMConexion : TDMConexion;

implementation

{%CLASSGROUP 'Vcl.Controls.TControl'}

{$R *.dfm}

{$REGION 'METODOS PROPIOS'}
procedure TDMConexion.DataModuleCreate(Sender: TObject);
var
  ArchConf : string;
begin
  { aqui se debe leer el .INI para cargar los parametros de conexión a la Base de Datos }
    ArchConf:= StringReplace(Application.ExeName,'.exe','.ini');
    FHost     := LeeVariableIni('CONFIGURACION','CONEXION',ArchConf);
    FAmbiente := LeeVariableIni('CONFIGURACION','INSTALACION',ArchConf);
    CoInitialize(nil);
    {desarrollo}
    if (FAmbiente = 'CLIENTE') OR (FAmbiente = 'PRODUCCION')
          OR (FAmbiente = 'DESARROLLO')   then
    BEGIN
      if (FAmbiente = 'CLIENTE') OR (FAmbiente = 'PRODUCCION')  then
      begin
        FUsuario  := 'produniandes';
        FPassword := 'Pr0dUn12015d';
        FBaseDatos:= 'UNIANDES';
        FEsquema  := 'andes_prod';
        FPuerto   := 5432;
        if FAmbiente = 'PRODUCCIÓN' then
          FTipoConeFtp := 'LOCAL'
        else
          FTipoConeFtp := 'REMOTO';
      end
      else
        if (FAmbiente = 'DESARROLLO') then
        begin
          FUsuario  := 'Andes.Aplicacion';
          FPassword := 'AndZOISApl';
          FBaseDatos:= 'UNIANDES';
          FEsquema  := 'andes_desa';
          FPuerto   := 5432;
          FTipoConeFtp := 'LOCAL'
        end;
      Conectar;
    END
    else
      raise Exception.Create('Error en el Archivo de Configuracion.');

end;

procedure TDMConexion.Conectar;
begin
  try
    with ZConexion do
    begin
      User     := FUsuario;
      Password := FPassword;
      HostName := FHost;
      Port     := FPuerto;
      Database := FBaseDatos;
      Connect;
      Disconnect;
    end;
  except
    on E:Exception do
      raise Exception.Create('Error al conectarse a la Base de Datos.'+ #10#13 + '* '
                              + e.Message);
  end;
end;

{$ENDREGION}

{$REGION 'GETTERS Y SETTERS'}

{$ENDREGION}

{$REGION 'CONSTRUCTOR Y DESTRUCTOR'}
{$ENDREGION}
end.
